pipeline{
	agent any

	stages{
		stage ('Compile Stage'){

			steps {
				withMaven(maven : 'Maven'){
					bat 'mvn clean compile'
				}
			}
		}
		stage ('Testing Stage'){

			steps {
				withMaven(maven : 'Maven'){
					bat 'mvn test'
				}
			}
		}
		stage ('Build Stage'){

			steps {
				withMaven(maven : 'Maven'){
					bat 'mvn install'
				}
			}
		}

		stage ('upload') {
  		  gitlabCommitStatus("upload") {
     		  def server = Artifactory.server "Jfrog"
   	          def buildInfo = Artifactory.newBuildInfo()
   	          buildInfo.env.capture = true
    		  buildInfo.env.collect()

    			  def uploadSpec = """{
     				   "files": [
       					   {
       						    "pattern": "C:/test/target/mehta.war",
        	       				    "target": "kartik_r"
       						   }   
       					 ]
      }"""
      }
      }
	}

}
